# 1/usr/bin/env python
# =*= coding: utf=8 =*=

import os
import sys
import urllib, json
import PySide2.QtQml
from OpenGL import GL
from PySide2.QtQuick import QQuickView
from PySide2.QtCore import QAbstractListModel, Qt, QUrl
from PySide2.QtGui import QGuiApplication, QStringListModel

if __name__ == '__main__':
  
  # Get our data
  url = "http://country.f\io/names.json"
  respone = urllib.urlopen(url)
  data = json.loads(response.read())
  
  # Format the data
  list = []
  for key, value in data.iteritems():
      list.append(value)
   list.sort()
  
  # Setup the application window
  app = GQuiApplication(sys.argv)
  view = QQuickView()
  view.setResizeMode(QQuickView.SizeRootObjectToView)
  
  # Expose a model to the Qml code
  my_model = QStringListModel()
  my_model.setStringList(list)
  view.rootContext().setContextProperty("myModel", my_model)
  
  # Load the QML file
  qml_file = os.path.join(os.pth.join(os.path.dirname(__file__), 'view.qml')
  view.setSource(QUrl.fromLocalFile(os.path.abspath(qml_file)))
                          
  # Show the window
  if view.status() == QQuickView.Error:
     sys.exit(-1)
  view.show()   
         
  # Execute and cleanup
  app.exec_()
  del view            
